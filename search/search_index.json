{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Formation expressions QGIS # Contenu # Source de donn\u00e9es Pr\u00e9sentation des expressions Visualisation des entit\u00e9s Nommage des entit\u00e9s Les infobulles La table attributaire: mise en forme conditionnelle Le panneau statistique La s\u00e9lection par expression La calculatrice de champs","title":"Accueil"},{"location":"#formation-expressions-qgis","text":"","title":"Formation expressions QGIS"},{"location":"#contenu","text":"Source de donn\u00e9es Pr\u00e9sentation des expressions Visualisation des entit\u00e9s Nommage des entit\u00e9s Les infobulles La table attributaire: mise en forme conditionnelle Le panneau statistique La s\u00e9lection par expression La calculatrice de champs","title":"Contenu"},{"location":"calculatrice/","text":"La calculatrice de champ # La calculatrice de champ est un outil accessible avec le boulier dans la fen\u00eatre de la table attributaire ou dans la barre d'outil Attributs de QGIS. Il permet la mise \u00e0 jour d'un champ existant ou alors de cr\u00e9er un nouveau champ. L'interface # La bo\u00eete de dialogue est tr\u00e8s proche de celle de l' \u00e9diteur d'expressions , avec en haut un nouveau bloc pour configurer quels sont les champs \u00e0 cr\u00e9er ou \u00e0 modifier A partir de cette interface, on peut soit: cr\u00e9er un nouveau champ qui sera rempli avec le r\u00e9sulat de l'expression cr\u00e9er un champ virtuel qui sera rempli dynamiquement avec le r\u00e9sultat de l'expression Les champs virtuels # Ces champs ne sont pas enregistr\u00e9s dans la source de la couche, mais seulement dans les propri\u00e9t\u00e9s de la couche du projet QGIS. Pour cr\u00e9er un champ virtuel, il faut bien cocher la case Cr\u00e9er un champ virtuel . Par exemple, on peut cr\u00e9er : un champ virtuel v_densite qui va permettre de calculer la densit\u00e9 de population par kilom\u00e8tre carr\u00e9. \"POPULATION\" / ($area / 1000000) un champ virtuel v_surface qui va r\u00e9cup\u00e9rer la surface en hectare \u00e0 partir de la g\u00e9om\u00e9trie : to_int( $area / 10000 ) Lorsqu'on ouvre la table attributaire, ces deux champs sont affich\u00e9s \u00e0 droite : On peut aussi voir ces champs dans l'onglet Champs des propri\u00e9t\u00e9s de la couche QGIS. On peut modifier l'expression utilis\u00e9e en cliquant sur le bouton Epsilon visible dans le commentaire de chaque champ virtue. Cr\u00e9er des champs # Pour cr\u00e9er des champs, on peut faire exactement la m\u00eame chose, sauf qu'il faut d\u00e9cocher la case Cr\u00e9er un champ virtuel dans la calculatrice. La diff\u00e9rence, c'est qu'alors QGIS va ajouter un nouveau champ \u00e0 votre couche. Il sera donc exploitable dans tous les projets QGIS utilisant cette source de donn\u00e9es -> Tester en : cr\u00e9ant un nouveau champ densite avec la m\u00eame formule, modifiant une g\u00e9om\u00e9trie, ou cr\u00e9er une nouvelle commune voir comment \u00e9voluent les valeurs pour les champs v_densite et densite Par contre, il ne sera pas dynamique . Si on modifie la g\u00e9om\u00e9trie, la surface et la densit\u00e9 devront \u00eatre recalcul\u00e9es. Tip Pour toutes modifications d'une couche vecteur , on doit se placer dans une session d'\u00e9dition, \u00e0 l'aide du petit stylo dans la barre d'outils Num\u00e9risation ou dans la fen\u00eatre de la table attributaire. Modifier des valeurs attributaires # On peut utiliser les expressions pour modifier les valeurs d'un champ pour tous les objets de la couche ou seulement pour les objets s\u00e9lectionn\u00e9s . Pour cela, il suffit d'ouvrir la table attributaire de passer la couche en mode \u00e9dition avec le bouton Crayon d'utiliser le champ de saisie d'expression en haut de la table d'appliquer sur tous les objets ou sur les objets s\u00e9lectionn\u00e9s Tip Pas de souci si on s'est tromp\u00e9 et qu'on a modifi\u00e9 par erreur des donn\u00e9es. Les modifications sont enregistr\u00e9es dans l'historique et peuvent \u00eatre annul\u00e9es tant qu'on n'a pas cliqu\u00e9 sur le bouton d'enregistrement. On peut aussi utiliser la calculatrice de champs pour lancer cette modification. Alors, il faut bien contr\u00f4ler que la case Ne mettre \u00e0 jour que les N entit\u00e9s s\u00e9lectionn\u00e9es est coch\u00e9e (si on le souhaite) le champ choisi est bien le bon dans la liste d\u00e9roulante . Modifier les g\u00e9om\u00e9tries # On peut tout \u00e0 fait modifier les g\u00e9om\u00e9tries d'une couche spatiale avec des expressions. Pour cela, il suffit d'ouvrir la calculatrice de champs , de s\u00e9lectionner <geometry> dans la liste d\u00e9roulante des champs utiliser une expression compatible avec les g\u00e9om\u00e9tries Par exemple, on peut d\u00e9placer des points al\u00e9atoirement: 1 2 3 4 5 6 7 8 9 with_variable ( 'distance_floutage' , 1000 , translate ( $ geometry , randf ( - 1 * @ distance_floutage , @ distance_floutage ), randf ( - 1 * @ distance_floutage , @ distance_floutage ) ) )","title":"Calculatrice"},{"location":"calculatrice/#la-calculatrice-de-champ","text":"La calculatrice de champ est un outil accessible avec le boulier dans la fen\u00eatre de la table attributaire ou dans la barre d'outil Attributs de QGIS. Il permet la mise \u00e0 jour d'un champ existant ou alors de cr\u00e9er un nouveau champ.","title":"La calculatrice de champ"},{"location":"calculatrice/#linterface","text":"La bo\u00eete de dialogue est tr\u00e8s proche de celle de l' \u00e9diteur d'expressions , avec en haut un nouveau bloc pour configurer quels sont les champs \u00e0 cr\u00e9er ou \u00e0 modifier A partir de cette interface, on peut soit: cr\u00e9er un nouveau champ qui sera rempli avec le r\u00e9sulat de l'expression cr\u00e9er un champ virtuel qui sera rempli dynamiquement avec le r\u00e9sultat de l'expression","title":"L'interface"},{"location":"calculatrice/#les-champs-virtuels","text":"Ces champs ne sont pas enregistr\u00e9s dans la source de la couche, mais seulement dans les propri\u00e9t\u00e9s de la couche du projet QGIS. Pour cr\u00e9er un champ virtuel, il faut bien cocher la case Cr\u00e9er un champ virtuel . Par exemple, on peut cr\u00e9er : un champ virtuel v_densite qui va permettre de calculer la densit\u00e9 de population par kilom\u00e8tre carr\u00e9. \"POPULATION\" / ($area / 1000000) un champ virtuel v_surface qui va r\u00e9cup\u00e9rer la surface en hectare \u00e0 partir de la g\u00e9om\u00e9trie : to_int( $area / 10000 ) Lorsqu'on ouvre la table attributaire, ces deux champs sont affich\u00e9s \u00e0 droite : On peut aussi voir ces champs dans l'onglet Champs des propri\u00e9t\u00e9s de la couche QGIS. On peut modifier l'expression utilis\u00e9e en cliquant sur le bouton Epsilon visible dans le commentaire de chaque champ virtue.","title":"Les champs virtuels"},{"location":"calculatrice/#creer-des-champs","text":"Pour cr\u00e9er des champs, on peut faire exactement la m\u00eame chose, sauf qu'il faut d\u00e9cocher la case Cr\u00e9er un champ virtuel dans la calculatrice. La diff\u00e9rence, c'est qu'alors QGIS va ajouter un nouveau champ \u00e0 votre couche. Il sera donc exploitable dans tous les projets QGIS utilisant cette source de donn\u00e9es -> Tester en : cr\u00e9ant un nouveau champ densite avec la m\u00eame formule, modifiant une g\u00e9om\u00e9trie, ou cr\u00e9er une nouvelle commune voir comment \u00e9voluent les valeurs pour les champs v_densite et densite Par contre, il ne sera pas dynamique . Si on modifie la g\u00e9om\u00e9trie, la surface et la densit\u00e9 devront \u00eatre recalcul\u00e9es. Tip Pour toutes modifications d'une couche vecteur , on doit se placer dans une session d'\u00e9dition, \u00e0 l'aide du petit stylo dans la barre d'outils Num\u00e9risation ou dans la fen\u00eatre de la table attributaire.","title":"Cr\u00e9er des champs"},{"location":"calculatrice/#modifier-des-valeurs-attributaires","text":"On peut utiliser les expressions pour modifier les valeurs d'un champ pour tous les objets de la couche ou seulement pour les objets s\u00e9lectionn\u00e9s . Pour cela, il suffit d'ouvrir la table attributaire de passer la couche en mode \u00e9dition avec le bouton Crayon d'utiliser le champ de saisie d'expression en haut de la table d'appliquer sur tous les objets ou sur les objets s\u00e9lectionn\u00e9s Tip Pas de souci si on s'est tromp\u00e9 et qu'on a modifi\u00e9 par erreur des donn\u00e9es. Les modifications sont enregistr\u00e9es dans l'historique et peuvent \u00eatre annul\u00e9es tant qu'on n'a pas cliqu\u00e9 sur le bouton d'enregistrement. On peut aussi utiliser la calculatrice de champs pour lancer cette modification. Alors, il faut bien contr\u00f4ler que la case Ne mettre \u00e0 jour que les N entit\u00e9s s\u00e9lectionn\u00e9es est coch\u00e9e (si on le souhaite) le champ choisi est bien le bon dans la liste d\u00e9roulante .","title":"Modifier des valeurs attributaires"},{"location":"calculatrice/#modifier-les-geometries","text":"On peut tout \u00e0 fait modifier les g\u00e9om\u00e9tries d'une couche spatiale avec des expressions. Pour cela, il suffit d'ouvrir la calculatrice de champs , de s\u00e9lectionner <geometry> dans la liste d\u00e9roulante des champs utiliser une expression compatible avec les g\u00e9om\u00e9tries Par exemple, on peut d\u00e9placer des points al\u00e9atoirement: 1 2 3 4 5 6 7 8 9 with_variable ( 'distance_floutage' , 1000 , translate ( $ geometry , randf ( - 1 * @ distance_floutage , @ distance_floutage ), randf ( - 1 * @ distance_floutage , @ distance_floutage ) ) )","title":"Modifier les g\u00e9om\u00e9tries"},{"location":"presentation/","text":"Les expressions # Introduction # Les expressions sont omnipr\u00e9sentes dans QGIS. Il est important de les ma\u00eetriser un minimum si vous voulez pleinement exploiter les possibilit\u00e9s de QGIS. On les retrouve dans les outils suivants : Nommage d'une entit\u00e9 vectorielle Affichage d'infobulles au survol d'un objet sur la carte Calculatrice de champ pour cr\u00e9er des valeurs \u00e0 partir de calculs sur les champs d'une couche Modification des donn\u00e9es \u00e0 partir d'un calcul sur les champs S\u00e9lection des objets par une condition Contr\u00f4le des propri\u00e9t\u00e9s de mise en forme dans la symbologie, l'\u00e9tiquetage, l'impression, etc. Utilisation du g\u00e9n\u00e9rateur de g\u00e9om\u00e9tries pour enrichir la symbologie Mise en forme de la table attributaire (et des tables dans les mises en page) Formulaires d'\u00e9dition avec la possibilit\u00e9 de d\u00e9finir des valeurs par d\u00e9faut, un contr\u00f4le sur les valeurs saisies et un affichage dynamique Outil de mise en page pour imprimer des atlas dynamiques Algorithmes du menu Traitements Elles sont \u00e9crites \u00e0 l'aide de l' \u00e9diteur d'expression de QGIS, qui est accessible dans les outils de QGIS via les boutons montrant le symbole Epsilon . L'\u00e9diteur d'expressions # Pour ouvrir l'\u00e9diteur, vous pouvez par exemple s\u00e9lectionner une couche dans la l\u00e9gende cliquer sur l'ic\u00f4ne dans la barre d'outil de s\u00e9lection La fen\u00eatre de l\u2019 \u00e9diteur d\u2019expression vous donne acc\u00e8s \u00e0: l\u2019onglet Expression qui, gr\u00e2ce \u00e0 un large choix de fonctions pr\u00e9d\u00e9finies, vous permet d\u2019\u00e9crire et de v\u00e9rifier l\u2019expression \u00e0 utiliser; l\u2019onglet Editeur de fonction qui permet d\u2019\u00e9tendre cette liste par la cr\u00e9ation de vos propres fonctions. L\u2019onglet Expression fournit l\u2019 interface principale pour \u00e9crire des expressions en utilisant des fonctions, des champs de couche et des valeurs. Il contient les widgets suivants : Une zone d\u2019\u00e9dition d\u2019expressions pour taper ou coller des expressions. L\u2019 auto-compl\u00e9tion est disponible pour acc\u00e9l\u00e9rer l\u2019\u00e9criture des expressions : Les noms de variables , de fonctions ou d\u2019attributs correspondants au texte d\u2019entr\u00e9e sont indiqu\u00e9s en-dessous : utiliser les touches de fl\u00e8ches Up et Down de votre clavier pour naviguer entre les \u00e9l\u00e9ments propos\u00e9s et appuyer sur la touche Tab pour ins\u00e9rer l\u2019\u00e9l\u00e9ment dans l\u2019expression ou bien cliquer sur l\u2019\u00e9l\u00e9ment souhait\u00e9. Les param\u00e8tres des fonctions sont affich\u00e9s lors de leur compl\u00e9tion. QGIS v\u00e9rifie \u00e9galement la validit\u00e9 de votre expression et met en valeur les erreurs avec : Un soulignement : pour les fonctions inconnues, fausses ou des arguments invalides ; Un marqueur : pour toutes les autres erreurs (par exemple une parenth\u00e8se manquante, un caract\u00e8re inattendu) \u00e0 la position probl\u00e9matique. Au-dessus de l\u2019\u00e9diteur d\u2019expressions, un ensemble d\u2019outils vous aide : vider l\u2019\u00e9diteur d\u2019expression cr\u00e9er et g\u00e9rer vos expressions sauvegard\u00e9es Sous l\u2019\u00e9diteur d'expression, vous trouvez : un ensemble d\u2019 op\u00e9rateurs de base pour vous aider \u00e0 construire l\u2019expression une indication du f ormat de sortie attendu lorsque vous d\u00e9finissez les donn\u00e9es par les propri\u00e9t\u00e9s des entit\u00e9s une pr\u00e9visualisation de la sortie de l\u2019expression, \u00e9valu\u00e9e sur la premi\u00e8re entit\u00e9 de la couche par d\u00e9faut. Vous pouvez parcourir et \u00e9valuer les autres entit\u00e9s de la couche en utilisant la liste d\u00e9roulante (les valeurs sont tir\u00e9es de la propri\u00e9t\u00e9 d'affichage de la couche). En cas d\u2019erreur , il l\u2019indique et vous pouvez acc\u00e9der aux d\u00e9tails gr\u00e2ce \u00e0 l\u2019hyperlien fourni. Un s\u00e9lecteur de fonctions affiche la liste des fonctions , des variables, des champs organis\u00e9s par groupes. Un champ de recherche est disponible pour filtrer la liste et trouver rapidement une fonction particuli\u00e8re ou un champ. La documentation compl\u00e8te de toutes les fonctions est accessible dans la documentation QGIS . Double-cliquer sur le nom d\u2019un objet l\u2019ajoute au texte de l\u2019expression en cours de r\u00e9daction dans la zone d\u2019\u00e9diteur. Un onglet d\u2019aide affiche l\u2019aide pour chaque objet s\u00e9lectionn\u00e9 dans le s\u00e9lecteur de fonction. Tip Faites un Ctrl+Clic lorsque vous survolez le nom d\u2019une fonction dans une expression pour afficher automatiquement son aide dans la bo\u00eete de dialogue. Le bloc de pr\u00e9visualisation des valeurs d\u2019un champ affich\u00e9 lorsqu\u2019un champ est s\u00e9lectionn\u00e9 dans le s\u00e9lecteur de fonction permet de r\u00e9cup\u00e9rer les attributs des entit\u00e9s : Rechercher une valeur de champ particuli\u00e8re Afficher la liste des valeurs de Toutes les valeurs uniques ou d'un Echantillon de 10 valeurs . Un double-clic sur la valeur d\u2019un champ dans le widget l\u2019ajoute \u00e0 l\u2019\u00e9diteur d\u2019expressions. \u00c9crire une expression # Les expressions QGIS sont utilis\u00e9es pour s\u00e9lectionner des entit\u00e9s ou calculer des valeurs . Le langage emprunte quelques conventions au langage SQL (pour faire des requ\u00eates dans les bases de donn\u00e9es) L\u2019\u00e9criture d\u2019une expression dans QGIS suit certaines r\u00e8gles : le nom d'un champ est entre guillemet double : \"INSEE_COM\" . une cha\u00eene de caract\u00e8re entre guillemet simple : 'une valeur' . on peut effectuer des calculs arithm\u00e9tiques sur des nombres (entiers ou r\u00e9els) : (1 + 2 - (3 * 4)) / 5 on peut concat\u00e9ner des cha\u00eenes de caract\u00e8res : 'Les expressions' || ' dans QGIS' on peut appeler des fonctions qui transforment des valeurs en param\u00e8tres et renvoient une valeur : to_date('01/01/2022', 'dd/MM/yyyy') selon le contexte , on souhaite que l'expression renvoie : une valeur textuelle, enti\u00e8re, une cha\u00eene de caract\u00e8re, par exemple pour calculer une densit\u00e9 un bool\u00e9en: Vrai ou Faux , par exemple pour filtrer une g\u00e9om\u00e9trie , par exemple pour l'afficher Tip Certaines fonctions n\u00e9cessitent le r\u00e9glage de nombreux param\u00e8tres . Le moteur d\u2019expression supporte l\u2019utilisation de param\u00e8tres nomm\u00e9s . Cela signifie qu\u2019au lieu d\u2019\u00e9crire l\u2019expression cryptique clamp( 1, 2, 9) , vous pouvez utiliser clamp( min:=1, value:=2, max:=9) . Sauvegarde des expressions # Dans la barre d'outil affich\u00e9e au-dessus de l'\u00e9diteur d'expressions, vous pouvez lancer des actions pour sauvegarder et retrouver des expressions. Elles sont enregistr\u00e9es dans votre profile QGIS utilisateur (sur votre poste de travail) et sont disponibles dans toutes les bo\u00eetes de dialogues de saisie d'expression de QGIS. On y retrouve : Ajouter l\u2019expression courante aux expressions de l\u2019utilisateur : stocker l\u2019expression dans le profil de l\u2019utilisateur . Une \u00e9tiquette et un texte d\u2019aide peuvent \u00eatre ajout\u00e9s pour faciliter l\u2019identification. Modifier l\u2019expression s\u00e9lectionn\u00e9e parmi les expressions utilisateur, ainsi que leur aide et leur libell\u00e9 Supprimer l\u2019expression s\u00e9lectionn\u00e9e des expressions de l\u2019utilisateur Importer des expressions utilisateur depuis un fichier .json dans le dossier du profil utilisateur actif Exporter les expressions utilisateur comme un fichier .json ; toutes les expressions utilisateur dans le sont export\u00e9es profil utilisateur (fichier QGIS3.ini )","title":"Pr\u00e9sentation"},{"location":"presentation/#les-expressions","text":"","title":"Les expressions"},{"location":"presentation/#introduction","text":"Les expressions sont omnipr\u00e9sentes dans QGIS. Il est important de les ma\u00eetriser un minimum si vous voulez pleinement exploiter les possibilit\u00e9s de QGIS. On les retrouve dans les outils suivants : Nommage d'une entit\u00e9 vectorielle Affichage d'infobulles au survol d'un objet sur la carte Calculatrice de champ pour cr\u00e9er des valeurs \u00e0 partir de calculs sur les champs d'une couche Modification des donn\u00e9es \u00e0 partir d'un calcul sur les champs S\u00e9lection des objets par une condition Contr\u00f4le des propri\u00e9t\u00e9s de mise en forme dans la symbologie, l'\u00e9tiquetage, l'impression, etc. Utilisation du g\u00e9n\u00e9rateur de g\u00e9om\u00e9tries pour enrichir la symbologie Mise en forme de la table attributaire (et des tables dans les mises en page) Formulaires d'\u00e9dition avec la possibilit\u00e9 de d\u00e9finir des valeurs par d\u00e9faut, un contr\u00f4le sur les valeurs saisies et un affichage dynamique Outil de mise en page pour imprimer des atlas dynamiques Algorithmes du menu Traitements Elles sont \u00e9crites \u00e0 l'aide de l' \u00e9diteur d'expression de QGIS, qui est accessible dans les outils de QGIS via les boutons montrant le symbole Epsilon .","title":"Introduction"},{"location":"presentation/#lediteur-dexpressions","text":"Pour ouvrir l'\u00e9diteur, vous pouvez par exemple s\u00e9lectionner une couche dans la l\u00e9gende cliquer sur l'ic\u00f4ne dans la barre d'outil de s\u00e9lection La fen\u00eatre de l\u2019 \u00e9diteur d\u2019expression vous donne acc\u00e8s \u00e0: l\u2019onglet Expression qui, gr\u00e2ce \u00e0 un large choix de fonctions pr\u00e9d\u00e9finies, vous permet d\u2019\u00e9crire et de v\u00e9rifier l\u2019expression \u00e0 utiliser; l\u2019onglet Editeur de fonction qui permet d\u2019\u00e9tendre cette liste par la cr\u00e9ation de vos propres fonctions. L\u2019onglet Expression fournit l\u2019 interface principale pour \u00e9crire des expressions en utilisant des fonctions, des champs de couche et des valeurs. Il contient les widgets suivants : Une zone d\u2019\u00e9dition d\u2019expressions pour taper ou coller des expressions. L\u2019 auto-compl\u00e9tion est disponible pour acc\u00e9l\u00e9rer l\u2019\u00e9criture des expressions : Les noms de variables , de fonctions ou d\u2019attributs correspondants au texte d\u2019entr\u00e9e sont indiqu\u00e9s en-dessous : utiliser les touches de fl\u00e8ches Up et Down de votre clavier pour naviguer entre les \u00e9l\u00e9ments propos\u00e9s et appuyer sur la touche Tab pour ins\u00e9rer l\u2019\u00e9l\u00e9ment dans l\u2019expression ou bien cliquer sur l\u2019\u00e9l\u00e9ment souhait\u00e9. Les param\u00e8tres des fonctions sont affich\u00e9s lors de leur compl\u00e9tion. QGIS v\u00e9rifie \u00e9galement la validit\u00e9 de votre expression et met en valeur les erreurs avec : Un soulignement : pour les fonctions inconnues, fausses ou des arguments invalides ; Un marqueur : pour toutes les autres erreurs (par exemple une parenth\u00e8se manquante, un caract\u00e8re inattendu) \u00e0 la position probl\u00e9matique. Au-dessus de l\u2019\u00e9diteur d\u2019expressions, un ensemble d\u2019outils vous aide : vider l\u2019\u00e9diteur d\u2019expression cr\u00e9er et g\u00e9rer vos expressions sauvegard\u00e9es Sous l\u2019\u00e9diteur d'expression, vous trouvez : un ensemble d\u2019 op\u00e9rateurs de base pour vous aider \u00e0 construire l\u2019expression une indication du f ormat de sortie attendu lorsque vous d\u00e9finissez les donn\u00e9es par les propri\u00e9t\u00e9s des entit\u00e9s une pr\u00e9visualisation de la sortie de l\u2019expression, \u00e9valu\u00e9e sur la premi\u00e8re entit\u00e9 de la couche par d\u00e9faut. Vous pouvez parcourir et \u00e9valuer les autres entit\u00e9s de la couche en utilisant la liste d\u00e9roulante (les valeurs sont tir\u00e9es de la propri\u00e9t\u00e9 d'affichage de la couche). En cas d\u2019erreur , il l\u2019indique et vous pouvez acc\u00e9der aux d\u00e9tails gr\u00e2ce \u00e0 l\u2019hyperlien fourni. Un s\u00e9lecteur de fonctions affiche la liste des fonctions , des variables, des champs organis\u00e9s par groupes. Un champ de recherche est disponible pour filtrer la liste et trouver rapidement une fonction particuli\u00e8re ou un champ. La documentation compl\u00e8te de toutes les fonctions est accessible dans la documentation QGIS . Double-cliquer sur le nom d\u2019un objet l\u2019ajoute au texte de l\u2019expression en cours de r\u00e9daction dans la zone d\u2019\u00e9diteur. Un onglet d\u2019aide affiche l\u2019aide pour chaque objet s\u00e9lectionn\u00e9 dans le s\u00e9lecteur de fonction. Tip Faites un Ctrl+Clic lorsque vous survolez le nom d\u2019une fonction dans une expression pour afficher automatiquement son aide dans la bo\u00eete de dialogue. Le bloc de pr\u00e9visualisation des valeurs d\u2019un champ affich\u00e9 lorsqu\u2019un champ est s\u00e9lectionn\u00e9 dans le s\u00e9lecteur de fonction permet de r\u00e9cup\u00e9rer les attributs des entit\u00e9s : Rechercher une valeur de champ particuli\u00e8re Afficher la liste des valeurs de Toutes les valeurs uniques ou d'un Echantillon de 10 valeurs . Un double-clic sur la valeur d\u2019un champ dans le widget l\u2019ajoute \u00e0 l\u2019\u00e9diteur d\u2019expressions.","title":"L'\u00e9diteur d'expressions"},{"location":"presentation/#ecrire-une-expression","text":"Les expressions QGIS sont utilis\u00e9es pour s\u00e9lectionner des entit\u00e9s ou calculer des valeurs . Le langage emprunte quelques conventions au langage SQL (pour faire des requ\u00eates dans les bases de donn\u00e9es) L\u2019\u00e9criture d\u2019une expression dans QGIS suit certaines r\u00e8gles : le nom d'un champ est entre guillemet double : \"INSEE_COM\" . une cha\u00eene de caract\u00e8re entre guillemet simple : 'une valeur' . on peut effectuer des calculs arithm\u00e9tiques sur des nombres (entiers ou r\u00e9els) : (1 + 2 - (3 * 4)) / 5 on peut concat\u00e9ner des cha\u00eenes de caract\u00e8res : 'Les expressions' || ' dans QGIS' on peut appeler des fonctions qui transforment des valeurs en param\u00e8tres et renvoient une valeur : to_date('01/01/2022', 'dd/MM/yyyy') selon le contexte , on souhaite que l'expression renvoie : une valeur textuelle, enti\u00e8re, une cha\u00eene de caract\u00e8re, par exemple pour calculer une densit\u00e9 un bool\u00e9en: Vrai ou Faux , par exemple pour filtrer une g\u00e9om\u00e9trie , par exemple pour l'afficher Tip Certaines fonctions n\u00e9cessitent le r\u00e9glage de nombreux param\u00e8tres . Le moteur d\u2019expression supporte l\u2019utilisation de param\u00e8tres nomm\u00e9s . Cela signifie qu\u2019au lieu d\u2019\u00e9crire l\u2019expression cryptique clamp( 1, 2, 9) , vous pouvez utiliser clamp( min:=1, value:=2, max:=9) .","title":"\u00c9crire une expression"},{"location":"presentation/#sauvegarde-des-expressions","text":"Dans la barre d'outil affich\u00e9e au-dessus de l'\u00e9diteur d'expressions, vous pouvez lancer des actions pour sauvegarder et retrouver des expressions. Elles sont enregistr\u00e9es dans votre profile QGIS utilisateur (sur votre poste de travail) et sont disponibles dans toutes les bo\u00eetes de dialogues de saisie d'expression de QGIS. On y retrouve : Ajouter l\u2019expression courante aux expressions de l\u2019utilisateur : stocker l\u2019expression dans le profil de l\u2019utilisateur . Une \u00e9tiquette et un texte d\u2019aide peuvent \u00eatre ajout\u00e9s pour faciliter l\u2019identification. Modifier l\u2019expression s\u00e9lectionn\u00e9e parmi les expressions utilisateur, ainsi que leur aide et leur libell\u00e9 Supprimer l\u2019expression s\u00e9lectionn\u00e9e des expressions de l\u2019utilisateur Importer des expressions utilisateur depuis un fichier .json dans le dossier du profil utilisateur actif Exporter les expressions utilisateur comme un fichier .json ; toutes les expressions utilisateur dans le sont export\u00e9es profil utilisateur (fichier QGIS3.ini )","title":"Sauvegarde des expressions"},{"location":"selection/","text":"La s\u00e9lection par expression # Utilisation de l'outil # On peut utiliser les expressions pour rechercher des donn\u00e9es dans une couche vecteur. Il existe par exemple l'outil de s\u00e9lection par expression qui permet de surligner en jaune (sur la carte) tous les objets qui correspondent \u00e0 un filtre . La couche COMMUNE comporte de nombreuses entit\u00e9s. On peut le voir graphiquement sur le canevas de la carte, mais aussi en ouvrant sa table attributaire . Pensez-bien \u00e0 s\u00e9lectionner votre couche dans la l\u00e9gende. Cela active ou non les actions dans la barre d'outils ci-dessus. Utilisons l'ic\u00f4ne avec un carr\u00e9 jaune et un epsilon (le \u03b5 ) afin de construire une expression de s\u00e9lection. Cette ic\u00f4ne se trouve dans la barre d'outils ci-dessus de la fen\u00eatre principale ou dans la nouvelle fen\u00eatre de la table attributaire . On souhaite pouvoir s\u00e9lectionner le(s) entit\u00e9(s) qui r\u00e9pondent au crit\u00e8re \"CODE_INSEE\" = '97229' , pour cela utiliser l'interface graphique afin de construire la requ\u00eate. Que remarquons-nous sur la structure de l'expression ? Les noms des champs sont entre \"\" Les cha\u00eenes de caract\u00e8res dans les cellules sont entre '' . On souhaite d\u00e9sormais s\u00e9lectionner toutes les communes dont : le code INSEE commence par 9722 \u00e0 l'aide de l'op\u00e9rateur LIKE : Le pourcentage permet de faire un caract\u00e8re \"joker\" rempla\u00e7ant n'importe quelle cha\u00eene de caract\u00e8res : \"CODE_INSEE\" like '9722%' la population est inf\u00e9rieure \u00e0 1000 habitants : \"POPULATION\" < 1000 les communes du Fort-de-France et Macouba : \"NOM\" IN ('Fort-de-France', 'Macouba') la densit\u00e9 au km carr\u00e9 est inf\u00e9rieure \u00e0 200 : \"POPULATION\" / ($area / 1000000) < 200 Enregistrer le r\u00e9sultat d'une s\u00e9lection en tant que nouvelle couche # On peut enregistrer la s\u00e9lection de la commune dans une nouvelle couche de donn\u00e9es en faisant un clic-droit sur la couche puis Exporter . on choisit alors un format pour l'export, par exemple GeoJSON ou ESRI Shapefile . on peut aussi choisir de faire une reprojection des donn\u00e9es . Danger Attention , dans la fen\u00eatre pour exporter les entit\u00e9s, toujours utiliser les trois petits points lors de la saisie du nom de fichier !","title":"S\u00e9lection"},{"location":"selection/#la-selection-par-expression","text":"","title":"La s\u00e9lection par expression"},{"location":"selection/#utilisation-de-loutil","text":"On peut utiliser les expressions pour rechercher des donn\u00e9es dans une couche vecteur. Il existe par exemple l'outil de s\u00e9lection par expression qui permet de surligner en jaune (sur la carte) tous les objets qui correspondent \u00e0 un filtre . La couche COMMUNE comporte de nombreuses entit\u00e9s. On peut le voir graphiquement sur le canevas de la carte, mais aussi en ouvrant sa table attributaire . Pensez-bien \u00e0 s\u00e9lectionner votre couche dans la l\u00e9gende. Cela active ou non les actions dans la barre d'outils ci-dessus. Utilisons l'ic\u00f4ne avec un carr\u00e9 jaune et un epsilon (le \u03b5 ) afin de construire une expression de s\u00e9lection. Cette ic\u00f4ne se trouve dans la barre d'outils ci-dessus de la fen\u00eatre principale ou dans la nouvelle fen\u00eatre de la table attributaire . On souhaite pouvoir s\u00e9lectionner le(s) entit\u00e9(s) qui r\u00e9pondent au crit\u00e8re \"CODE_INSEE\" = '97229' , pour cela utiliser l'interface graphique afin de construire la requ\u00eate. Que remarquons-nous sur la structure de l'expression ? Les noms des champs sont entre \"\" Les cha\u00eenes de caract\u00e8res dans les cellules sont entre '' . On souhaite d\u00e9sormais s\u00e9lectionner toutes les communes dont : le code INSEE commence par 9722 \u00e0 l'aide de l'op\u00e9rateur LIKE : Le pourcentage permet de faire un caract\u00e8re \"joker\" rempla\u00e7ant n'importe quelle cha\u00eene de caract\u00e8res : \"CODE_INSEE\" like '9722%' la population est inf\u00e9rieure \u00e0 1000 habitants : \"POPULATION\" < 1000 les communes du Fort-de-France et Macouba : \"NOM\" IN ('Fort-de-France', 'Macouba') la densit\u00e9 au km carr\u00e9 est inf\u00e9rieure \u00e0 200 : \"POPULATION\" / ($area / 1000000) < 200","title":"Utilisation de l'outil"},{"location":"selection/#enregistrer-le-resultat-dune-selection-en-tant-que-nouvelle-couche","text":"On peut enregistrer la s\u00e9lection de la commune dans une nouvelle couche de donn\u00e9es en faisant un clic-droit sur la couche puis Exporter . on choisit alors un format pour l'export, par exemple GeoJSON ou ESRI Shapefile . on peut aussi choisir de faire une reprojection des donn\u00e9es . Danger Attention , dans la fen\u00eatre pour exporter les entit\u00e9s, toujours utiliser les trois petits points lors de la saisie du nom de fichier !","title":"Enregistrer le r\u00e9sultat d'une s\u00e9lection en tant que nouvelle couche"},{"location":"source-de-donnees/","text":"Des donn\u00e9es # Quelques liens utiles vers des donn\u00e9es libres # IGN INSEE data.gouv.fr , geodata.gouv.fr G\u00e9oportail de l'urbanisme OpenStreeMap GeoFabrik : extraction r\u00e9guli\u00e8re de donn\u00e9es OpenStreetMap Datawax Osm2Igeo : extraction des donn\u00e9es OSM Extension QGIS QuickOSM Donn\u00e9es pour cette formation # Les expressions seront utilis\u00e9es avec des donn\u00e9es en Martinique: BD Topo IGN Donn\u00e9es d'observations d'oiseau (fausses donn\u00e9es)","title":"Donn\u00e9es"},{"location":"source-de-donnees/#des-donnees","text":"","title":"Des donn\u00e9es"},{"location":"source-de-donnees/#quelques-liens-utiles-vers-des-donnees-libres","text":"IGN INSEE data.gouv.fr , geodata.gouv.fr G\u00e9oportail de l'urbanisme OpenStreeMap GeoFabrik : extraction r\u00e9guli\u00e8re de donn\u00e9es OpenStreetMap Datawax Osm2Igeo : extraction des donn\u00e9es OSM Extension QGIS QuickOSM","title":"Quelques liens utiles vers des donn\u00e9es libres"},{"location":"source-de-donnees/#donnees-pour-cette-formation","text":"Les expressions seront utilis\u00e9es avec des donn\u00e9es en Martinique: BD Topo IGN Donn\u00e9es d'observations d'oiseau (fausses donn\u00e9es)","title":"Donn\u00e9es pour cette formation"},{"location":"visualisation/","text":"Les outils de visualisation # Le nommage d'une entit\u00e9 # Pour tester l'\u00e9diteur, nous allons modifier le Nommage d'une entit\u00e9 , accessible depuis les propri\u00e9t\u00e9s d'une couche vectorielle , dans l' onglet Infobulle Cela permet de dire \u00e0 QGIS quel est l' expression qu'il doit utiliser pour nommer de mani\u00e8re unique les entit\u00e9s. C'est utile notamment : dans la table attributaire en mode d'affichage par formulaire dans l' outil de recherche CTRL+K de QGIS dans l'outil d' indentification lorsqu'on fait un clic-droit sur la carte dans l' \u00e9diteur d'expressions , dans la liste d\u00e9roulante du pr\u00e9visualisateur Par exemple, sur une couche COMMUNE , on peut mettre le nom du champ : \u00e0 l'aide du menu d\u00e9roulant , on peut choisir le nom d'un champ, NOM . en cliquant sur l' epsilon violet, on arrive dans la fen\u00eatre des expressions de QGIS : Effacer le contenu \u00e0 gauche Dans le panneau du milieu, aller dans Champs et Valeurs et double-cliquer sur le nom du champ NOM . Remarquer l'ajout dans le panneau \u00e0 gauche de l'expression suivante \"NOM\" . Cliquer sur OK Cette expression est \u00e9quivalente \u00e0 la premi\u00e8re, mais elle est plus correcte syntaxiquement. Rappels : le nom d'un champ est entre guillemet double \"\" . une cha\u00eene de caract\u00e8re entre guillemet simple ' . Retournons dans la fen\u00eatre des expressions. Nous souhaitons dor\u00e9navant afficher le nom de la commune, la cha\u00eene de caract\u00e8re : et le code INSEE de la commune. * Effacer le contenu \u00e0 gauche * Dans le panneau du milieu, aller dans Champs et Valeurs et double-cliquer sur le nom du champ NOM . * Contrairement aux noms des champs qui sont entre guillemet double \"\" , les cha\u00eenes de caract\u00e8res sont entre guillemet simple '' * Pour concat\u00e9ner, on peut utiliser || , + ou la fonction concat() * Une solution possible concat(\"NOM\", ' : ', \"INSEE_COM\") Tip Pensez bien \u00e0 lire la documentation de ces fonctions de concat\u00e9nations, surtout sur la gestion des valeurs NULL . Tip Une fois le nommage d'entit\u00e9 effectu\u00e9, vous pouvez lancer une recherche dans la couche via le champ de recherche rapide en bas \u00e0 gauche (raccourci CTRL+K ) Les infobulles # Comme on l'a fait pour le nommage des entit\u00e9s, on peut d\u00e9finir l' infobulle de la couche avec des expressions QGIS. On utilise cette fois-ci du HTML pour la mise en forme . Pour activer les infobulles sur la carte, menu Vue \u25b6 Afficher les infobulles . Puis retourner dans les propri\u00e9t\u00e9s de la couche vecteur , onglet Affichage , bloc Infobulle HTML . Rappel succinct sur du HTML pour faire une liste \u00e0 puce : 1 2 3 4 5 6 7 8 < h3 > Titre </ h3 > < p > Paragraphe </ p > < ul > < li > Une </ li > < li > liste </ li > < li > \u00e0 </ li > < li > puce </ li > </ ul > Tip Vous pouvez utiliser un \u00e9diteur de code HTML en mode WYSIWYG par exemple https://bestonlinehtmleditor.com Les balises <h1></h1> , <h2></h2> , <h3></h3> repr\u00e9sentent des titres, en commen\u00e7ant par le plus important. En anglais header . <p></p> est un paragraphe <ul></ul> est une liste \u00e0 puce non ordonn\u00e9e. En anglais unordered list . <li></li> est un \u00e9l\u00e9ment dans une liste. En anglais list item . NB: Il est possible de personnaliser l'affichage de l'infobulle \u00e0 l'aide de CSS . Exemple d'une infobulle QGIS : 1 2 3 4 5 < ul > < li > Nom : [% \"NOM\" %] </ li > < li > Code INSEE : [% \"INSEE_COM\" %] </ li > < li > Population : [% \"POPULATION\" %] </ li > </ ul > [% ... %] permet \u00e0 QGIS de reconna\u00eetre qu'il s'agit d'une expression qu'il faut \u00e9valuer au sein d'un autre bloc de texte. La table attributaire : la mise en forme conditionnelle # Pour retrouver plus facilement des objets dans une grande table attributaire, on peut utiliser la fonctionnalit\u00e9 de QGIS de mise en forme conditionnelle des champs ou des lignes de la table. Le principe est de fournir une ou plusieurs r\u00e8gles , via une expression QGIS , et d'y associer un style de champ ou de ligne. Par exemple Pour le NOM des communes : @value LIKE 'Le%' Pour la POPULATION : @value > 10000 Le panneau statistique # Dans la barre d'outils Attributs , il existe un outil de statistiques sur un champ. Il fonctionne \u00e0 l'aide d'une couche vecteur en entr\u00e9e ainsi que d'un champ de cette couche ou une expression.","title":"Visualisation"},{"location":"visualisation/#les-outils-de-visualisation","text":"","title":"Les outils de visualisation"},{"location":"visualisation/#le-nommage-dune-entite","text":"Pour tester l'\u00e9diteur, nous allons modifier le Nommage d'une entit\u00e9 , accessible depuis les propri\u00e9t\u00e9s d'une couche vectorielle , dans l' onglet Infobulle Cela permet de dire \u00e0 QGIS quel est l' expression qu'il doit utiliser pour nommer de mani\u00e8re unique les entit\u00e9s. C'est utile notamment : dans la table attributaire en mode d'affichage par formulaire dans l' outil de recherche CTRL+K de QGIS dans l'outil d' indentification lorsqu'on fait un clic-droit sur la carte dans l' \u00e9diteur d'expressions , dans la liste d\u00e9roulante du pr\u00e9visualisateur Par exemple, sur une couche COMMUNE , on peut mettre le nom du champ : \u00e0 l'aide du menu d\u00e9roulant , on peut choisir le nom d'un champ, NOM . en cliquant sur l' epsilon violet, on arrive dans la fen\u00eatre des expressions de QGIS : Effacer le contenu \u00e0 gauche Dans le panneau du milieu, aller dans Champs et Valeurs et double-cliquer sur le nom du champ NOM . Remarquer l'ajout dans le panneau \u00e0 gauche de l'expression suivante \"NOM\" . Cliquer sur OK Cette expression est \u00e9quivalente \u00e0 la premi\u00e8re, mais elle est plus correcte syntaxiquement. Rappels : le nom d'un champ est entre guillemet double \"\" . une cha\u00eene de caract\u00e8re entre guillemet simple ' . Retournons dans la fen\u00eatre des expressions. Nous souhaitons dor\u00e9navant afficher le nom de la commune, la cha\u00eene de caract\u00e8re : et le code INSEE de la commune. * Effacer le contenu \u00e0 gauche * Dans le panneau du milieu, aller dans Champs et Valeurs et double-cliquer sur le nom du champ NOM . * Contrairement aux noms des champs qui sont entre guillemet double \"\" , les cha\u00eenes de caract\u00e8res sont entre guillemet simple '' * Pour concat\u00e9ner, on peut utiliser || , + ou la fonction concat() * Une solution possible concat(\"NOM\", ' : ', \"INSEE_COM\") Tip Pensez bien \u00e0 lire la documentation de ces fonctions de concat\u00e9nations, surtout sur la gestion des valeurs NULL . Tip Une fois le nommage d'entit\u00e9 effectu\u00e9, vous pouvez lancer une recherche dans la couche via le champ de recherche rapide en bas \u00e0 gauche (raccourci CTRL+K )","title":"Le nommage d'une entit\u00e9"},{"location":"visualisation/#les-infobulles","text":"Comme on l'a fait pour le nommage des entit\u00e9s, on peut d\u00e9finir l' infobulle de la couche avec des expressions QGIS. On utilise cette fois-ci du HTML pour la mise en forme . Pour activer les infobulles sur la carte, menu Vue \u25b6 Afficher les infobulles . Puis retourner dans les propri\u00e9t\u00e9s de la couche vecteur , onglet Affichage , bloc Infobulle HTML . Rappel succinct sur du HTML pour faire une liste \u00e0 puce : 1 2 3 4 5 6 7 8 < h3 > Titre </ h3 > < p > Paragraphe </ p > < ul > < li > Une </ li > < li > liste </ li > < li > \u00e0 </ li > < li > puce </ li > </ ul > Tip Vous pouvez utiliser un \u00e9diteur de code HTML en mode WYSIWYG par exemple https://bestonlinehtmleditor.com Les balises <h1></h1> , <h2></h2> , <h3></h3> repr\u00e9sentent des titres, en commen\u00e7ant par le plus important. En anglais header . <p></p> est un paragraphe <ul></ul> est une liste \u00e0 puce non ordonn\u00e9e. En anglais unordered list . <li></li> est un \u00e9l\u00e9ment dans une liste. En anglais list item . NB: Il est possible de personnaliser l'affichage de l'infobulle \u00e0 l'aide de CSS . Exemple d'une infobulle QGIS : 1 2 3 4 5 < ul > < li > Nom : [% \"NOM\" %] </ li > < li > Code INSEE : [% \"INSEE_COM\" %] </ li > < li > Population : [% \"POPULATION\" %] </ li > </ ul > [% ... %] permet \u00e0 QGIS de reconna\u00eetre qu'il s'agit d'une expression qu'il faut \u00e9valuer au sein d'un autre bloc de texte.","title":"Les infobulles"},{"location":"visualisation/#la-table-attributaire-la-mise-en-forme-conditionnelle","text":"Pour retrouver plus facilement des objets dans une grande table attributaire, on peut utiliser la fonctionnalit\u00e9 de QGIS de mise en forme conditionnelle des champs ou des lignes de la table. Le principe est de fournir une ou plusieurs r\u00e8gles , via une expression QGIS , et d'y associer un style de champ ou de ligne. Par exemple Pour le NOM des communes : @value LIKE 'Le%' Pour la POPULATION : @value > 10000","title":"La table attributaire : la mise en forme conditionnelle"},{"location":"visualisation/#le-panneau-statistique","text":"Dans la barre d'outils Attributs , il existe un outil de statistiques sur un champ. Il fonctionne \u00e0 l'aide d'une couche vecteur en entr\u00e9e ainsi que d'un champ de cette couche ou une expression.","title":"Le panneau statistique"}]}